<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qiuxs.cuteframework.web.log.dao.ApiRequestLogDao">

	<sql id="allFields">
		`id`,
		`api_key` as apiKey,
		`server_id` as serverId,
		`req_ip` as reqIp,
		`req_url` as reqUrl,
		`req_start_time` as reqStartTime,
		`req_end_time` as reqEndTime,
		`status`
	</sql>

	<sql id="insertFields">
		`id`,
		`api_key`,
		`server_id`,
		`req_ip`,
		`req_url`,
		`req_start_time`,
		`req_end_time`,
		`status`
	</sql>

	<select id="list" resultType="com.qiuxs.cuteframework.web.log.entity.ApiRequestLog" >
		select
			<include refid="allFields" />
		from `api_request_log`
		<where>
			<include refid="comnWhere" />
		</where>
		<if test="orderBy != null" >
			order by ${orderBy}
			<if test="orderByDesc != null">
				desc
			</if>
		</if>
	</select>
	
	<select id="getCount" resultType="Long" >
		select 
			count(1) 
		from `api_request_log`
		<where>
			<include refid="comnWhere" />
		</where>
	</select>

	<sql id="comnWhere">
		<if test="id != null">
			`id` = #{id}
		</if>
		<if test="apiKey != null">
			 and `api_key` = #{apiKey}
		</if>
		<if test="serverId != null">
			 and `server_id` = #{serverId}
		</if>
		<if test="reqIp != null">
			 and `req_ip` = #{reqIp}
		</if>
		<if test="reqUrl != null">
			 and `req_url` = #{reqUrl}
		</if>
		<if test="reqStartTime != null">
			 and `req_start_time` = #{reqStartTime}
		</if>
		<if test="reqEndTime != null">
			 and `req_end_time` = #{reqEndTime}
		</if>
		<if test="status != null">
			and `status` = #{status}
		</if>
	</sql>

	<select id="getByIds" resultType="com.qiuxs.cuteframework.web.log.entity.ApiRequestLog" >
		select <include refid="allFields" /> from `api_request_log` where id in
		<foreach collection="list" item="item" open="(" separator="," close=")" >
			#{item}
		</foreach>
	</select>

	<select id="get" resultType="com.qiuxs.cuteframework.web.log.entity.ApiRequestLog" >
		select <include refid="allFields" /> from `api_request_log` where id = #{id}
	</select>

	<delete id="deleteById" parameterType="Long" >
		delete from `api_request_log` where id = #{id}
	</delete>

	<insert id="insert" parameterType="com.qiuxs.cuteframework.web.log.entity.ApiRequestLog">
		insert into `api_request_log`(<include refid="insertFields" />)
		values(
			#{id},
			#{apiKey},
			#{serverId},
			#{reqIp},
			#{reqUrl},
			#{reqStartTime},
			#{reqEndTime},
			#{status}
		)
	</insert>

	<insert id="insertInBatch" parameterType="java.util.List" >
		insert into `api_request_log`(<include refid="insertFields" />)
		values
		<foreach collection="list" item="item" separator="," >
			(
				#{item.id},
				#{item.apiKey},
				#{item.serverId},
				#{item.reqIp},
				#{item.reqUrl},
				#{item.reqStartTime},
				#{item.reqEndTime},
				#{item.status}
			)
		</foreach>
	</insert>

	<update id="update" parameterType="com.qiuxs.cuteframework.web.log.entity.ApiRequestLog" >
		update `api_request_log` 
			<set>
				<include refid="setComn" />
			</set>
		where id = #{id}
	</update>

	<sql id="setComn" >
		<if test="apiKey != null" >
			`api_key` = #{apiKey},
		</if>
		<if test="serverId != null" >
			`server_id` = #{serverId},
		</if>
		<if test="reqIp != null" >
			`req_ip` = #{reqIp},
		</if>
		<if test="reqUrl != null" >
			`req_url` = #{reqUrl},
		</if>
		<if test="reqStartTime != null" >
			`req_start_time` = #{reqStartTime},
		</if>
		<if test="reqEndTime != null" >
			`req_end_time` = #{reqEndTime},
		</if>
		<if test="status != null">
			`status` = #{status}
		</if>
	</sql>
</mapper>